# ‚úÖ PostgreSQL Migration Complete!

> **–î–∞—Ç–∞:** 08.02.2026  
> **–°—Ç–∞—Ç—É—Å:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ –∫–æ–¥–∏–Ω–≥—É  
> **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~1 —á–∞—Å

---

## üéØ –ß—Ç–æ –°–¥–µ–ª–∞–Ω–æ

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (3 —Ñ–∞–π–ª–∞)

1. **`docs/02_ARCHITECTURE.md`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ PostgreSQL –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ä—ã–Ω–∫–∞
   - –û–ø–∏—Å–∞–Ω Audit Trail (paper_trail ‚Üí pgaudit migration path)
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–∏–∞–≥—Ä–∞–º–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–¥–æ–±–∞–≤–ª–µ–Ω—ã `versions`, `OneC::SyncService`, `external_1c_id`)

2. **`docs/03_DATABASE.md`**
   - –û–±–Ω–æ–≤–ª–µ–Ω header: PostgreSQL 16+ –≤–º–µ—Å—Ç–æ SQLite
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `users`: `external_1c_id`, `synced_from_1c_at`, `metadata` (JSONB)
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `versions` (paper_trail —Å—Ö–µ–º–∞)
   - –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ PostgreSQL + –ø—Ä–∏–º–µ—Ä—ã JSONB –∑–∞–ø—Ä–æ—Å–æ–≤

3. **`docs/09_DEVELOPMENT_PLAN.md`**
   - –û–±–Ω–æ–≤–ª–µ–Ω Day 1: –¥–æ–±–∞–≤–ª–µ–Ω Docker Compose setup
   - –ö–æ–º–∞–Ω–¥—ã –º–∏–≥—Ä–∞—Ü–∏–π –≤–∫–ª—é—á–∞—é—Ç `external_1c_id` + `metadata:jsonb`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ paper_trail
   - –í—Ä–µ–º—è Day 1: 7-8 —á–∞—Å–æ–≤ (–±—ã–ª–æ 6-7)

### ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –ö–æ–Ω—Ñ–∏–≥–∏ (3 —Ñ–∞–π–ª–∞)

4. **`Gemfile`**
   - –ó–∞–º–µ–Ω–µ–Ω–æ: `gem "sqlite3"` ‚Üí `gem "pg", "~> 1.5"`
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `gem "paper_trail", "~> 15.0"` (audit trail)
   - –î–æ–±–∞–≤–ª–µ–Ω–æ: `gem "acts_as_tenant"`, `gem "bcrypt"`, `gem "blueprinter"`, `gem "pagy"`

5. **`config/database.yml`**
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ PostgreSQL 16
   - Development: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `localhost:5432` (Docker Compose)
   - Production: 4 –ë–î (primary, cache, queue, cable) —á–µ—Ä–µ–∑ ENV variables
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: `prepared_statements`, `statement_timeout`

6. **`docker-compose.yml`** (–ù–û–í–´–ô –§–ê–ô–õ)
   - PostgreSQL 16 Alpine –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π volume –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `docker/postgres/init.sql`
   - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π pgAdmin (GUI) —á–µ—Ä–µ–∑ `--profile tools`

### ‚úÖ –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –§–∞–π–ª—ã (2 —Ñ–∞–π–ª–∞)

7. **`docker/postgres/init.sql`** (–ù–û–í–´–ô –§–ê–ô–õ)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î: development, test, cache, queue, cable
   - Grant permissions –¥–ª—è postgres user

8. **`docs/POSTGRESQL_MIGRATION.md`** (–ù–û–í–´–ô –§–ê–ô–õ)
   - –ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –º–∏–≥—Ä–∞—Ü–∏–∏ (3000+ —Å–ª–æ–≤)
   - –ß–µ–∫-–ª–∏—Å—Ç –∫–æ–º–∞–Ω–¥ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞
   - Troubleshooting —Å–µ–∫—Ü–∏—è
   - –ü—Ä–∏–º–µ—Ä—ã paper_trail, JSONB queries

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ (–ì–æ—Ç–æ–≤ –ö–æ–¥–∏—Ç—å!)

### 1. –ó–∞–ø—É—Å–∫ –û–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
docker-compose ps

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
bundle install
npm install
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î + –ú–∏–≥—Ä–∞—Ü–∏–∏ (–î–µ–Ω—å 1 –ü–ª–∞–Ω–∞)

```bash
# –°–æ–∑–¥–∞—Ç—å –ë–î
bin/rails db:create

# –°–ª–µ–¥–æ–≤–∞—Ç—å –ø–ª–∞–Ω—É –∏–∑ docs/09_DEVELOPMENT_PLAN.md
# –î–µ–Ω—å 1: Database & Models
```

**–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–ø–∏—Å–∞–Ω—ã –≤:**
- `docs/POSTGRESQL_MIGRATION.md` (–¥–µ—Ç–∞–ª—å–Ω—ã–π –≥–∞–π–¥)
- `docs/09_DEVELOPMENT_PLAN.md` (–ø–ª–∞–Ω –Ω–∞ 5 –Ω–µ–¥–µ–ª—å)

---

## üìä –ß—Ç–æ –ü–æ–ª—É—á–∏–ª–∏

### ‚úÖ Enterprise-Ready –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –§—É–Ω–∫—Ü–∏—è | SQLite | PostgreSQL ‚úÖ |
|---------|--------|---------------|
| **Concurrent writes** | ‚ùå Lock timeout | ‚úÖ MVCC |
| **1–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | ‚ùå –ù–µ—Ç –¥—Ä–∞–π–≤–µ—Ä–æ–≤ | ‚úÖ ODBC/JDBC |
| **Audit trail** | ‚ùå Custom –∫–æ–¥ | ‚úÖ paper_trail + pgaudit |
| **JSONB** | ‚ö†Ô∏è JSON (–º–µ–¥–ª–µ–Ω–Ω–æ) | ‚úÖ –ò–Ω–¥–µ–∫—Å—ã GIN |
| **On-premise** | ‚ö†Ô∏è –ù–µ –ø—Ä–æ–¥–∞—Ç—å | ‚úÖ 800K‚ÇΩ pricing |
| **–î–æ–≤–µ—Ä–∏–µ –°–ë** | ‚ùå "–ò–≥—Ä—É—à–∫–∞" | ‚úÖ "–°–µ—Ä—å–µ–∑–Ω–∞—è –ë–î" |

### ‚úÖ –ó–∞–ª–æ–∂–µ–Ω–Ω–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥ –ë—É–¥—É—â–µ–µ

**1–°:–ó–£–ü –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (v2, —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞):**
- `users.external_1c_id` ‚Äî –≥–æ—Ç–æ–≤–æ
- `users.synced_from_1c_at` ‚Äî –≥–æ—Ç–æ–≤–æ
- `users.metadata` (JSONB) ‚Äî –≥–æ—Ç–æ–≤–æ
- `OneC::SyncService` ‚Äî –∑–∞–≥–æ—Ç–æ–≤–∫–∞ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

**Audit Trail (—É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):**
- `paper_trail` gem ‚Äî –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —á–∞—Å—Ç–Ω—ã—Ö –∑–∞–≤–æ–¥–æ–≤
- Migration path –∫ `pgaudit` ‚Äî –¥–ª—è –≥–æ—Å–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

**On-Premise (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞):**
- Docker Compose –∫–æ–Ω—Ñ–∏–≥ ‚Äî —É–∂–µ –µ—Å—Ç—å
- PostgreSQL multi-database ‚Äî –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- Kamal 2 deployment ‚Äî –≥–æ—Ç–æ–≤

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –†–µ—à–µ–Ω–∏—è

### –í—Ä–µ–º—è –ú–∏–≥—Ä–∞—Ü–∏–∏

**–°–ï–ô–ß–ê–° (Day 0):** +1 –¥–µ–Ω—å (7-8 —á–∞—Å–æ–≤ –≤–º–µ—Å—Ç–æ 6-7)  
**–ü–û–¢–û–ú (–ø–æ—Å–ª–µ MVP):** +2-3 –Ω–µ–¥–µ–ª–∏ + downtime + —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤

### –í—ã–≥–æ–¥–∞

‚úÖ **–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:**
- 1–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è ‚Üí –ö–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞ –¥–ª—è –†–§ —Ä—ã–Ω–∫–∞
- On-premise –ø—Ä–æ–¥–∞–∂–∏ ‚Üí 800,000‚ÇΩ –µ–¥–∏–Ω–æ—Ä–∞–∑–æ–≤–æ
- Enterprise compliance ‚Üí –ì–æ—Å–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã
- Audit trail ‚Üí "–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π" –≤–∫–ª–∞–¥–∫–∞ –≤ UI (–ø—Ä–æ–¥–∞—é—â–∞—è —Ñ–∏—á–∞)

‚úÖ **–ò–∑–±–µ–∂–∞–ª–∏:**
- –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤ production
- Downtime –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–æ—Ç–µ—Ä—è –∫–ª–∏–µ–Ω—Ç–æ–≤ ("–ö–æ–≥–¥–∞ 1–° –±—É–¥–µ—Ç?")

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –§–∞–π–ª—ã (–°–≤–æ–¥–∫–∞)

```
v7-industrialprofi-platform-v7/
‚îú‚îÄ‚îÄ Gemfile                              # ‚úèÔ∏è Updated (pg, paper_trail)
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ database.yml                     # ‚úèÔ∏è Updated (PostgreSQL)
‚îú‚îÄ‚îÄ docker-compose.yml                   # ‚ú® NEW
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ postgres/
‚îÇ       ‚îî‚îÄ‚îÄ init.sql                     # ‚ú® NEW
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ 02_ARCHITECTURE.md               # ‚úèÔ∏è Updated (PostgreSQL, audit)
    ‚îú‚îÄ‚îÄ 03_DATABASE.md                   # ‚úèÔ∏è Updated (1C fields, versions)
    ‚îú‚îÄ‚îÄ 09_DEVELOPMENT_PLAN.md           # ‚úèÔ∏è Updated (Day 1 commands)
    ‚îî‚îÄ‚îÄ POSTGRESQL_MIGRATION.md          # ‚ú® NEW (–≥–∞–π–¥ –º–∏–≥—Ä–∞—Ü–∏–∏)
```

**–ò—Ç–æ–≥–æ:**
- 3 —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- 3 —Ñ–∞–π–ª–∞ —Å–æ–∑–¥–∞–Ω—ã
- 0 —Ñ–∞–π–ª–æ–≤ —É–¥–∞–ª–µ–Ω–æ
- 0 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –Ω–∞–ø–∏—Å–∞–Ω–æ (–µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∏ –∫–æ–¥–∏–Ω–≥!)

---

## üéâ –ì–æ—Ç–æ–≤–æ –∫ –†–∞–±–æ—Ç–µ!

**–í—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.**  
**–ö–æ–Ω—Ñ–∏–≥–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.**  
**Docker Compose –≥–æ—Ç–æ–≤.**  

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –°—Ç–∞—Ä—Ç–∞:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
docker-compose up -d

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
bundle install && npm install

# 3. –°–æ–∑–¥–∞—Ç—å –ë–î
bin/rails db:create

# 4. –ù–∞—á–∞—Ç—å –î–µ–Ω—å 1 (docs/09_DEVELOPMENT_PLAN.md)
# –°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π + –º–∏–≥—Ä–∞—Ü–∏–π
```

**–ü–æ–ª–Ω—ã–π –≥–∞–π–¥:** `docs/POSTGRESQL_MIGRATION.md`

---

## üí¨ –§–∏–Ω–∞–ª—å–Ω—ã–µ –ú—ã—Å–ª–∏

–¢–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ **–º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL —Å–µ–π—á–∞—Å** ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ.

**–ü–æ—á–µ–º—É:**
1. –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ä—ã–Ω–æ–∫ **—Ç—Ä–µ–±—É–µ—Ç** 1–° –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
2. –ß–∞—Å—Ç–Ω—ã–µ –∑–∞–≤–æ–¥—ã **–¥–æ–≤–µ—Ä—è—é—Ç** PostgreSQL (–Ω–µ SQLite)
3. On-premise –ø—Ä–æ–¥–∞–∂–∏ (800K‚ÇΩ) **–Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã** –Ω–∞ SQLite
4. –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–µ–π—á–∞—Å: **1 –¥–µ–Ω—å** vs –ø–æ—Ç–æ–º: **2-3 –Ω–µ–¥–µ–ª–∏**

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ù–∞—á–∞—Ç—å –∫–æ–¥–∏–Ω–≥ (–î–µ–Ω—å 1 –ø–ª–∞–Ω–∞)

**–£–¥–∞—á–∏! üöÄ**

---

**P.S.** –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ:
- –ß–∏—Ç–∞–π `docs/POSTGRESQL_MIGRATION.md` (—Ç–∞–º –í–°–Å –¥–µ—Ç–∞–ª—å–Ω–æ)
- Troubleshooting —Å–µ–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Å –æ—à–∏–±–∫–∞–º–∏
- Docker –∫–æ–º–∞–Ω–¥—ã —Ç–∞–º –∂–µ
