#!/bin/bash

# Tmux Development Environment Ğ´Ğ»Ñ Rails + Vite + Inertia
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: ./bin/tmux-dev

SESSION_NAME="industrialprofi"
WORK_DIR=$(pwd)

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½ Ğ»Ğ¸ tmux
if ! command -v tmux &> /dev/null; then
    echo "âŒ tmux Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ: sudo apt-get install tmux"
    exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ ÑĞµÑÑĞ¸Ğ¸
if tmux has-session -t $SESSION_NAME 2>/dev/null; then
    echo "ğŸ“Œ Ğ¡ĞµÑÑĞ¸Ñ '$SESSION_NAME' ÑƒĞ¶Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒĞµÑ‚. ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ÑÑÑŒ..."
    tmux attach-session -t $SESSION_NAME
    exit 0
fi

echo "ğŸš€ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ tmux ÑĞµÑÑĞ¸Ñ '$SESSION_NAME'..."

# Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ½Ğ¾Ğ²ÑƒÑ ÑĞµÑÑĞ¸Ñ (detached)
tmux new-session -d -s $SESSION_NAME -n "main" -c "$WORK_DIR"

# ============================================
# ĞŸĞĞĞ•Ğ›Ğ¬ 1: Rails Server (ÑĞ»ĞµĞ²Ğ° Ğ²Ğ²ĞµÑ€Ñ…Ñƒ)
# ============================================
tmux send-keys -t $SESSION_NAME:main "clear" C-m
tmux send-keys -t $SESSION_NAME:main "echo 'ğŸ›¤ï¸  Rails Server'" C-m
tmux send-keys -t $SESSION_NAME:main "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'" C-m
tmux send-keys -t $SESSION_NAME:main "bin/rails s" C-m

# ============================================
# ĞŸĞĞĞ•Ğ›Ğ¬ 2: Vite Server (ÑĞ¿Ñ€Ğ°Ğ²Ğ° Ğ²Ğ²ĞµÑ€Ñ…Ñƒ)
# ============================================
tmux split-window -h -t $SESSION_NAME:main -c "$WORK_DIR"
tmux send-keys -t $SESSION_NAME:main "clear" C-m
tmux send-keys -t $SESSION_NAME:main "echo 'âš¡ Vite Dev Server'" C-m
tmux send-keys -t $SESSION_NAME:main "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'" C-m
tmux send-keys -t $SESSION_NAME:main "bin/vite dev" C-m

# ============================================
# ĞŸĞĞĞ•Ğ›Ğ¬ 3: Terminal (Ğ²Ğ½Ğ¸Ğ·Ñƒ Ğ²Ğ¾ Ğ²ÑÑ ÑˆĞ¸Ñ€Ğ¸Ğ½Ñƒ)
# ============================================
tmux split-window -v -t $SESSION_NAME:main.0 -c "$WORK_DIR"
tmux send-keys -t $SESSION_NAME:main.2 "clear" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo 'ğŸ’» Rails Console / Commands'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo 'Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo '  rails c       - Rails ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo '  rails db:...  - Database ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo '  rails routes  - ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹'" C-m
tmux send-keys -t $SESSION_NAME:main.2 "echo ''" C-m

# ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ğ¾Ğ² Ğ¿Ğ°Ğ½ĞµĞ»ĞµĞ¹
tmux resize-pane -t $SESSION_NAME:main.0 -y 20  # Rails server
tmux resize-pane -t $SESSION_NAME:main.1 -y 20  # Vite server
tmux resize-pane -t $SESSION_NAME:main.2 -y 15  # Terminal

# ============================================
# Ğ”ĞĞŸĞĞ›ĞĞ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ• ĞĞšĞĞ: Database (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
# ============================================
tmux new-window -t $SESSION_NAME -n "db" -c "$WORK_DIR"
tmux send-keys -t $SESSION_NAME:db "clear" C-m
tmux send-keys -t $SESSION_NAME:db "echo 'ğŸ—„ï¸  Database Logs'" C-m
tmux send-keys -t $SESSION_NAME:db "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'" C-m
tmux send-keys -t $SESSION_NAME:db "docker-compose logs -f postgres" C-m

# ============================================
# Ğ”ĞĞŸĞĞ›ĞĞ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞĞ• ĞĞšĞĞ: Git (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)
# ============================================
tmux new-window -t $SESSION_NAME -n "git" -c "$WORK_DIR"
tmux send-keys -t $SESSION_NAME:git "clear" C-m
tmux send-keys -t $SESSION_NAME:git "echo 'ğŸ“¦ Git & Utilities'" C-m
tmux send-keys -t $SESSION_NAME:git "echo 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”'" C-m
tmux send-keys -t $SESSION_NAME:git "git status" C-m

# Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ÑÑ Ğº Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¼Ñƒ Ğ¾ĞºĞ½Ñƒ
tmux select-window -t $SESSION_NAME:main
tmux select-pane -t $SESSION_NAME:main.2

# ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ĞµĞ¼ÑÑ Ğº ÑĞµÑÑĞ¸Ğ¸
echo "âœ… Ğ¡ĞµÑÑĞ¸Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ°!"
echo ""
echo "Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ tmux:"
echo "  Ctrl+B, Ğ·Ğ°Ñ‚ĞµĞ¼ %     - Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾"
echo "  Ctrl+B, Ğ·Ğ°Ñ‚ĞµĞ¼ \"     - Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒ Ğ³Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾"
echo "  Ctrl+B, Ğ·Ğ°Ñ‚ĞµĞ¼ O     - Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ"
echo "  Ctrl+B, Ğ·Ğ°Ñ‚ĞµĞ¼ [0-9] - Ğ¿ĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ¾ĞºĞ½Ğ¾"
echo "  Ctrl+B, Ğ·Ğ°Ñ‚ĞµĞ¼ D     - Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ (detach)"
echo "  tmux attach -t $SESSION_NAME - Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒÑÑ ÑĞ½Ğ¾Ğ²Ğ°"
echo ""

tmux attach-session -t $SESSION_NAME
