#!/bin/bash

# Git Setup Script - ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ¸Ğ°ÑÑ‹ Ğ¸ Ñ…ÑƒĞºĞ¸
# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ: ./bin/git-setup

echo "ğŸ”§ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Git Ğ´Ğ»Ñ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸..."

# ==================================
# Git Aliases
# ==================================

echo "ğŸ“ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Git Ğ°Ğ»Ğ¸Ğ°ÑÑ‹..."

# Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.st status

# ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ°Ğ»Ğ¸Ğ°ÑÑ‹
git config --global alias.last 'log -1 HEAD'
git config --global alias.unstage 'reset HEAD --'
git config --global alias.visual 'log --oneline --graph --all --decorate'
git config --global alias.today 'log --since="1 day ago" --oneline'
git config --global alias.week 'log --since="1 week ago" --oneline'

# Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ÑĞ¾ĞºÑ€Ğ°Ñ‰ĞµĞ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ½Ğ°ÑˆĞµĞ³Ğ¾ workflow
git config alias.new-feature '!f() { git checkout -b feature/$1; }; f'
git config alias.new-fix '!f() { git checkout -b fix/$1; }; f'
git config alias.new-experiment '!f() { git checkout -b experiment/$1; }; f'

# Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ¾Ñ‚ĞºĞ°Ñ‚
git config alias.undo 'reset --soft HEAD~1'
git config alias.abort 'reset --hard HEAD'

# Cleanup
git config alias.cleanup '!git branch --merged | grep -v "main" | xargs git branch -d'

echo "âœ… Git Ğ°Ğ»Ğ¸Ğ°ÑÑ‹ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹!"
echo ""
echo "Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹:"
echo "  git co <branch>           - checkout"
echo "  git st                    - status"
echo "  git ci -m 'msg'           - commit"
echo "  git visual                - ĞºÑ€Ğ°ÑĞ¸Ğ²Ğ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ"
echo "  git today                 - ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ"
echo "  git week                  - ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ñ‹ Ğ·Ğ° Ğ½ĞµĞ´ĞµĞ»Ñ"
echo "  git new-feature <name>    - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ feature Ğ²ĞµÑ‚ĞºÑƒ"
echo "  git new-fix <name>        - ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ fix Ğ²ĞµÑ‚ĞºÑƒ"
echo "  git undo                  - Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚ (Ğ¼ÑĞ³ĞºĞ¾)"
echo "  git abort                 - Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ²ÑÑ‘ (Ğ¶Ñ‘ÑÑ‚ĞºĞ¾)"
echo "  git cleanup               - ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑĞ¼Ñ‘Ñ€Ğ¶ĞµĞ½Ğ½Ñ‹Ğµ Ğ²ĞµÑ‚ĞºĞ¸"
echo ""

# ==================================
# ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
# ==================================

echo "âš™ï¸  ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Git ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸..."

# Ğ¦Ğ²ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´
git config --global color.ui auto

# ĞĞ²Ñ‚Ğ¾ĞºĞ¾Ñ€Ñ€ĞµĞºÑ†Ğ¸Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´
git config --global help.autocorrect 10

# ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ€Ğ¸Ğ³Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ°Ñ…
git config --global merge.conflictstyle diff3

# Pull Ñ rebase Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ (Ñ‡Ğ¸Ñ‰Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ)
git config --global pull.rebase true

# Ğ—Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ñ‚ÑŒ Ñ€Ğ°Ğ·Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ»Ğ¸ĞºÑ‚Ğ¾Ğ²
git config --global rerere.enabled true

echo "âœ… Git ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ°!"
echo ""

# ==================================
# Pre-commit hook (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° .env)
# ==================================

echo "ğŸª ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° pre-commit hook..."

cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ñ‚Ğ¾ .env Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ğ² ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚
if git diff --cached --name-only | grep -E "^\.env$|^\.env\.local$|^\.env\.production$"; then
    echo "âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Ğ·Ğ°ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¸Ñ‚ÑŒ .env Ñ„Ğ°Ğ¹Ğ»!"
    echo "   Ğ­Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚Ñ‹."
    echo "   Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ .env.example Ğ²Ğ¼ĞµÑÑ‚Ğ¾ ÑÑ‚Ğ¾Ğ³Ğ¾."
    echo ""
    echo "   Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºÑƒ: git commit --no-verify"
    exit 1
fi

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ° TODO Ğ¸ FIXME
if git diff --cached | grep -E "TODO|FIXME" > /dev/null; then
    echo "âš ï¸  Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•: Ğ’ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğµ ĞµÑÑ‚ÑŒ TODO Ğ¸Ğ»Ğ¸ FIXME"
    echo "   Ğ­Ñ‚Ğ¾ Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾, Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ."
    echo ""
fi

exit 0
EOF

chmod +x .git/hooks/pre-commit

echo "âœ… Pre-commit hook ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½!"
echo "   - Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ° .env Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²"
echo "   - ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¾ TODO/FIXME"
echo ""

# ==================================
# Commit message template
# ==================================

echo "ğŸ“„ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ° commit message..."

cat > .git/.gitmessage << 'EOF'
# <type>: <ĞºÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ>
#
# Ğ¢Ğ¸Ğ¿Ñ‹:
#   Add:      Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»
#   Fix:      Ğ¸ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ³Ğ°
#   Update:   Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰ĞµĞ³Ğ¾
#   Remove:   ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ
#   Refactor: Ñ€ĞµÑ„Ğ°ĞºÑ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³
#   Docs:     Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
#   Test:     Ñ‚ĞµÑÑ‚Ñ‹
#
# ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
#   Add: user registration form
#   Fix: checkout total calculation
#   Update: product card styling
EOF

git config commit.template .git/.gitmessage

echo "âœ… Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½ commit message ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½!"
echo ""

# ==================================
# Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ
# ==================================

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ‰ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ°!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ:"
echo "  git visual        - Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ ĞºÑ€Ğ°ÑĞ¸Ğ²ÑƒÑ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ"
echo "  git new-feature user-profile"
echo "  git today         - Ñ‡Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ½Ğ¾ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ"
echo ""
echo "ğŸ“– ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½ĞµĞµ Ğ² DEVELOPMENT_WORKFLOW.md"
echo ""
